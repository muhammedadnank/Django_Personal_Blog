{% extends 'base.html' %}

{% block content %}
<article class="post-detail-container">
    <header class="post-detail-header">
        <div class="post-meta">
            <span class="post-date">{{ post.created_at|date:"F j, Y" }}</span>
            <span class="post-author">By {{ post.author.username }}</span>
            <span class="post-time">{{ post.get_reading_time }} min read</span>
        </div>
        <h1 class="post-title">{{ post.title }}</h1>
        {% if post.category %}
        <div class="post-category-badge">
            In <a href="{% url 'home' %}?category={{ post.category.slug }}">{{ post.category.name }}</a>
        </div>
        {% endif %}
    </header>

    {% if post.featured_image %}
    <div class="post-feature-image">
        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
    </div>
    {% endif %}

    <div class="post-body">
        {{ post.content|linebreaks }}
    </div>
    
    {% if post.tags.exists %}
    <div class="post-tags">
        <strong>Tags:</strong>
        {% for tag in post.tags.all %}
            <a href="{% url 'home' %}?tag={{ tag.slug }}">#{{ tag.name }}</a>
        {% endfor %}
    </div>
    {% endif %}

    <div class="post-footer">
        <a href="{% url 'home' %}" class="back-link">
            <span class="arrow">&larr;</span> Back to Home
        </a>
    </div>

    <!-- Related Posts -->
    {% if similar_posts %}
    <section class="related-posts">
        <h3>You might also like</h3>
        <div class="related-grid">
            {% for rpost in similar_posts %}
            <a href="{% url 'post_detail' rpost.slug %}" class="related-card">
                {% if rpost.featured_image %}
                <div class="related-image">
                    <img src="{{ rpost.featured_image.url }}" alt="{{ rpost.title }}">
                </div>
                {% endif %}
                <h4>{{ rpost.title }}</h4>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Comments Section -->
    <section class="comments-section">
        <h3>Comments ({{ comments.count }})</h3>
        
        <div class="comments-list">
            {% for comment in comments %}
            <div class="comment-item">
                <div class="comment-header">
                    <strong>{{ comment.name }}</strong>
                    <span>{{ comment.created_at|date:"M d, Y" }}</span>
                </div>
                <p>{{ comment.body }}</p>
            </div>
            {% empty %}
            <p class="no-comments">No comments yet. Be the first!</p>
            {% endfor %}
        </div>

        <div class="comment-form-container">
            <h4>Leave a Reply</h4>
            <form method="post" class="comment-form">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit" class="btn-submit">Post Comment</button>
            </form>
        </div>
    </section>
</article>
{% endblock %}
